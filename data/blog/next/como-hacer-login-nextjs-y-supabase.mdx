---
title: 'â¡ï¸Como Implementar AutenticaciÃ³n con Next.js y Supabase en Vercel: paso a paso'
date: '2025-03-15'
tags: ['nextjs', 'autenticacion', 'supabase']
draft: false
summary: 'Aprende a implementar un sistema de autenticaciÃ³n seguro en Next.js con Supabase, NextAuth y Drizzle.*  

Si quieres que resalte algÃºn otro detalle, dime y lo ajustamos. ğŸš€'
authors: ['default']
---
En este artÃ­culo, te enseÃ±arÃ© cÃ³mo implementar autenticaciÃ³n en **Next.js** utilizando **Supabase**. Usaremos **Supabase desde Vercel** y nos conectaremos a nuestra base de datos con **Drizzle ORM** y **NextAuth.js**.

![](https://res.cloudinary.com/dq0pfesxe/image/upload/v1742053319/Captura_de_pantalla_2025-03-15_163932_svo4ih.png)

## Requisitos

Antes de comenzar, asegÃºrate de tener lo siguiente:

- âœ… Una cuenta en **Supabase**
- âœ… Una cuenta en **Vercel**
- âœ… Un proyecto **Next.js** ya configurado

---

## Paso 1: Crear la base de datos en Vercel

Lo primero que haremos serÃ¡ crear nuestra base de datos **PostgreSQL** desde **Vercel**. En este caso, utilizaremos el plan gratuito de **Supabase**.

ğŸ”— **Ingresa a Vercel:** https://vercel.com/

### 1ï¸âƒ£ Seleccionar el proveedor de la base de datos

![](https://res.cloudinary.com/dq0pfesxe/image/upload/v1742053318/Captura_de_pantalla_2025-03-15_161017_puspge.png)

En Supabase, dentro de la secciÃ³n **Storage**, podemos crear bases de datos de diferentes proveedores. Selecciona **"Create Database"** y elige **Supabase**.

![](https://res.cloudinary.com/dq0pfesxe/image/upload/v1742053318/Captura_de_pantalla_2025-03-15_161027_bojsop.png)

### 2ï¸âƒ£ Elegir el plan gratuito

En este caso, usaremos el **plan gratuito**, que funciona bastante bien para desarrollo.

### 3ï¸âƒ£ Obtener las variables de entorno

Una vez creada la base de datos, se nos proporcionarÃ¡n las variables de entorno necesarias para la conexiÃ³n.

![](https://res.cloudinary.com/dq0pfesxe/image/upload/v1742053319/Captura_de_pantalla_2025-03-15_161211_dg8mez.png)

Agrega estas variables a tu archivo **.env** en tu proyecto:

```
POSTGRES_URL=
POSTGRES_PRISMA_URL=
POSTGRES_URL_NON_POOLING=

```

AdemÃ¡s, para trabajar en **localhost**, necesitaremos una variable extra:

```
AUTH_SECRET=

```

ğŸ”— Puedes generar una clave segura en este enlace: [Generate Secret](https://generate-secret.vercel.app/32)

---

## Paso 2: Instalar dependencias

Ahora instalemos todas las dependencias necesarias para que el proyecto funcione correctamente.

```bash
npm i bcrypt-ts
npm i drizzle-orm pg dotenv
npm i -D drizzle-kit tsx @types/pg
npm i next-auth

```

---

## Paso 3: Estructura de archivos

Antes de comenzar con la configuraciÃ³n, definamos la estructura del proyecto.

```
ğŸ“¦ app
 â”£ ğŸ“‚ api
 â”ƒ â”— ğŸ“‚ auth
 â”ƒ â”ƒ â”— ğŸ“‚ [...nextauth]
 â”ƒ â”ƒ â”ƒ â”— ğŸ“„ route.ts
 â”£ ğŸ“‚ login
 â”ƒ â”— ğŸ“„ page.tsx
 â”£ ğŸ“‚ register
 â”ƒ â”— ğŸ“„ page.tsx
 â”£ ğŸ“‚ protected
 â”ƒ â”— ğŸ“„ page.tsx
 â”£ ğŸ“„ auth.config.ts
 â”£ ğŸ“„ auth.ts
 â”£ ğŸ“„ db.ts
 â”£ ğŸ“„ page.tsx
 â”£ ğŸ“„ Form.tsx
 â”£ ğŸ“„ SubmitButton.tsx
 ğŸ“„ middleware.ts
 ğŸ“„ .env

```

Con esto, ya tenemos nuestra base lista para implementar la autenticaciÃ³n con **NextAuth.js**. ğŸš€

# Paso 4: Crear la lÃ³gica de autenticaciÃ³n

En este paso, construiremos toda la lÃ³gica de autenticaciÃ³n utilizando **Drizzle ORM**, **NextAuth.js** y **bcrypt-ts** para el manejo de usuarios y contraseÃ±as encriptadas.

---

## ğŸ“Œ **Definir la base de datos con Drizzle ORM**

La base de datos y el esquema de usuario estarÃ¡n en el archivo `db.ts`.

### ğŸ“„ `db.ts`

Este archivo define la conexiÃ³n a la base de datos PostgreSQL, maneja la creaciÃ³n de la tabla `User`, y proporciona funciones para registrar y buscar usuarios.

```tsx
import { drizzle } from 'drizzle-orm/postgres-js';
import { pgTable, serial, varchar } from 'drizzle-orm/pg-core';
import { eq } from 'drizzle-orm';
import postgres from 'postgres';
import { genSaltSync, hashSync } from 'bcrypt-ts';

// Conectamos a la base de datos con PostgreSQL y habilitamos SSL
let client = postgres(`${process.env.POSTGRES_URL!}?sslmode=require`);
let db = drizzle(client);

// FunciÃ³n para obtener un usuario por su email
export async function getUser(email: string) {
  const users = await ensureTableExists();
  return await db.select().from(users).where(eq(users.email, email));
}

// FunciÃ³n para crear un usuario con contraseÃ±a encriptada
export async function createUser(email: string, password: string) {
  const users = await ensureTableExists();
  let salt = genSaltSync(10); // Generamos un "sal" para la encriptaciÃ³n
  let hash = hashSync(password, salt); // Hasheamos la contraseÃ±a

  return await db.insert(users).values({ email, password: hash });
}

// FunciÃ³n para verificar si la tabla "User" existe, si no, la crea
async function ensureTableExists() {
  const result = await client`
    SELECT EXISTS (
      SELECT FROM information_schema.tables
      WHERE table_schema = 'public'
      AND table_name = 'User'
    );`;

  if (!result[0].exists) {
    await client`
      CREATE TABLE "User" (
        id SERIAL PRIMARY KEY,
        email VARCHAR(64),
        password VARCHAR(64)
      );`;
  }

  // Definimos la estructura de la tabla "User"
  const table = pgTable('User', {
    id: serial('id').primaryKey(),
    email: varchar('email', { length: 64 }),
    password: varchar('password', { length: 64 }),
  });

  return table;
}

```

âœ… **ExplicaciÃ³n:**

- Se conecta a la base de datos usando `postgres()` y `drizzle()`.
- `getUser(email)` busca un usuario por su correo electrÃ³nico.
- `createUser(email, password)` guarda un usuario con la contraseÃ±a encriptada con `bcrypt-ts`.
- `ensureTableExists()` verifica si la tabla `User` existe; si no, la crea.

[supabase table](https://res.cloudinary.com/dq0pfesxe/image/upload/v1742063040/Captura_de_pantalla_2025-03-15_192312_dfs7cf.png)
---

## ğŸ“Œ **Configurar la autenticaciÃ³n con NextAuth.js**

La lÃ³gica de autenticaciÃ³n se divide en dos archivos:

1. **`auth.ts`**: Define los controladores de inicio de sesiÃ³n con credenciales.
2. **`auth.config.ts`**: Configura los callbacks y redirecciones de NextAuth.

### ğŸ“„ `auth.ts`

Este archivo define cÃ³mo se maneja la autenticaciÃ³n con **NextAuth.js** y **credenciales personalizadas (email y contraseÃ±a)**.

```tsx
import NextAuth from 'next-auth';
import Credentials from 'next-auth/providers/credentials';
import { compare } from 'bcrypt-ts';
import { getUser } from 'app/db';
import { authConfig } from 'app/auth.config';

export const {
  handlers: { GET, POST }, // MÃ©todos para manejar autenticaciÃ³n desde API
  auth, // Middleware de autenticaciÃ³n
  signIn, // FunciÃ³n para iniciar sesiÃ³n
  signOut, // FunciÃ³n para cerrar sesiÃ³n
} = NextAuth({
  ...authConfig,
  providers: [
    Credentials({
      async authorize({ email, password }: any) {
        let user = await getUser(email);
        if (user.length === 0) return null;

        let passwordsMatch = await compare(password, user[0].password!);
        if (passwordsMatch) return user[0] as any; // Retorna el usuario si la contraseÃ±a es vÃ¡lida
        return null; // Si la contraseÃ±a no coincide, retorna null
      },
    }),
  ],
});

```

âœ… **ExplicaciÃ³n:**

- Se importa `NextAuth` y `Credentials` para manejar autenticaciÃ³n con credenciales.
- `getUser(email)` recupera el usuario desde la base de datos.
- Se usa `bcrypt-ts` para comparar la contraseÃ±a ingresada con la almacenada.
- `signIn` y `signOut` manejan el inicio y cierre de sesiÃ³n.

---

### ğŸ“„ `auth.config.ts`

Define la configuraciÃ³n general de NextAuth, incluyendo pÃ¡ginas personalizadas y reglas de acceso.

```tsx
import { NextAuthConfig } from 'next-auth';

export const authConfig = {
  pages: {
    signIn: '/login', // Redirige a /login cuando se requiere autenticaciÃ³n
  },
  callbacks: {
    authorized({ auth, request: { nextUrl } }) {
      let isLoggedIn = !!auth?.user; // Verifica si el usuario estÃ¡ autenticado
      let isOnDashboard = nextUrl.pathname.startsWith('/protected'); // Verifica si estÃ¡ en una ruta protegida

      if (isOnDashboard) {
        if (isLoggedIn) return true;
        return false; // Si no estÃ¡ autenticado, se le bloquea el acceso
      } else if (isLoggedIn) {
        return Response.redirect(new URL('/protected', nextUrl)); // Redirige a /protected si ya estÃ¡ logueado
      }

      return true;
    },
  },
} satisfies NextAuthConfig;

```

âœ… **ExplicaciÃ³n:**

- **`signIn: '/login'`** â†’ Personaliza la pÃ¡gina de inicio de sesiÃ³n.
- **`callbacks.authorized`** â†’ Define reglas de acceso a rutas protegidas.
    - Si el usuario intenta acceder a `/protected` sin autenticarse, se bloquea.
    - Si ya estÃ¡ autenticado y estÃ¡ en la pÃ¡gina de inicio, lo redirige a `/protected`.

---

## ğŸ“Œ **Configurar NextAuth en las rutas API**

En **Next.js App Router**, debemos exportar los controladores `GET` y `POST` de autenticaciÃ³n.

### ğŸ“„ `api/auth/[...nextauth]/route.ts`

```tsx
export { GET, POST } from 'app/auth';

```

âœ… **ExplicaciÃ³n:**

- Esto simplemente reexporta los mÃ©todos `GET` y `POST` definidos en `auth.ts`.
- Esto permite que NextAuth maneje la autenticaciÃ³n a travÃ©s de `/api/auth`.

---

## ğŸ“Œ **Configurar middleware para proteger rutas**

Finalmente, creamos un **middleware** que bloquearÃ¡ el acceso a rutas protegidas si el usuario no estÃ¡ autenticado.

### ğŸ“„ `middleware.ts`

```tsx
import NextAuth from 'next-auth';
import { authConfig } from 'app/auth.config';

export default NextAuth(authConfig).auth;

export const config = {
  matcher: ['/((?!api|_next/static|_next/image|.*\\.png$).*)'], // Aplica el middleware a todas las rutas excepto las estÃ¡ticas y la API
};

```

âœ… **ExplicaciÃ³n:**

- **`NextAuth(authConfig).auth;`** â†’ Usa la configuraciÃ³n de `auth.config.ts`.
- **`matcher`** â†’ Aplica el middleware a todas las rutas **excepto**:
    - `api/` (rutas de API)
    - `_next/static` y `_next/image` (archivos estÃ¡ticos)
    - ImÃ¡genes (`.png`)

---

## ğŸ¯ **Resumen**

1. **`db.ts`** â†’ ConexiÃ³n a PostgreSQL y definiciÃ³n de la tabla `User`.
2. **`auth.ts`** â†’ LÃ³gica de autenticaciÃ³n con credenciales y NextAuth.
3. **`auth.config.ts`** â†’ ConfiguraciÃ³n de pÃ¡ginas y reglas de acceso.
4. **`api/auth/[...nextauth]/route.ts`** â†’ Reexporta `GET` y `POST` para la API de autenticaciÃ³n.
5. **`middleware.ts`** â†’ Protege rutas privadas.

## Paso 5: Crear PÃ¡ginas y Utilizar la LÃ³gica de AutenticaciÃ³n

En este paso, comenzaremos a consumir la lÃ³gica creada previamente para manejar la autenticaciÃ³n, redirigir a una pÃ¡gina protegida y visualizar las tablas de nuestra base de datos.

---

## ğŸ“Œ PÃ¡gina de Bienvenida (`page.tsx`)

La pÃ¡gina de bienvenida es el primer punto de contacto de los usuarios con nuestra aplicaciÃ³n. Desde aquÃ­ pueden iniciar sesiÃ³n o registrarse.

![](https://res.cloudinary.com/dq0pfesxe/image/upload/v1742062538/Captura_de_pantalla_2025-03-15_191523_z0cqcn.png)

```tsx
import Link from "next/link";

export default function Page() {
  return (
    <div className="min-h-screen flex flex-col bg-gradient-to-br from-gray-900 to-gray-800">
      <main className="flex-1 flex flex-col items-center justify-center p-6">
        <div className="w-full max-w-md">
          <div className="text-center mb-10">
            <h1 className="text-4xl font-bold text-white mb-2">AppName</h1>
            <p className="text-gray-400">Tu soluciÃ³n simple para todo</p>
          </div>

          <div className="bg-white rounded-2xl shadow-2xl overflow-hidden">
            <div className="p-8 text-center border-b border-gray-200">
              <h2 className="text-2xl font-bold text-gray-800">Bienvenido</h2>
              <p className="text-gray-600 mt-1">Por favor, inicia sesiÃ³n o crea una cuenta</p>
            </div>

            <div className="p-6 space-y-4">
              <Link
                href="/login"
                className="block w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white font-medium text-center rounded-lg transition duration-200"
              >
                Iniciar SesiÃ³n
              </Link>

              <Link
                href="/register"
                className="block w-full py-3 px-4 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium text-center rounded-lg transition duration-200"
              >
                Registrarse
              </Link>
            </div>
          </div>
        </div>
      </main>

      <footer className="py-6 text-center text-gray-500 text-sm">
        <p>&copy; {new Date().getFullYear()} AppName. Todos los derechos reservados.</p>
      </footer>
    </div>
  );
}

```

### ExplicaciÃ³n:

- Presenta dos botones principales: **Iniciar SesiÃ³n** y **Registrarse**.
- No requiere autenticaciÃ³n para acceder.

---

## ğŸ“Œ Componentes Comunes: `Form.tsx` y `SubmitButton.tsx`

Estos componentes nos ayudarÃ¡n a evitar redundancia en las pÃ¡ginas de login y registro.

### `Form.tsx`

```tsx
export function Form({
  action,
  children,
}: {
  action: any;
  children: React.ReactNode;
}) {
  return (
    <form action={action} className="flex flex-col space-y-4 bg-gray-50 px-4 py-8 sm:px-16">
      <div>
        <label htmlFor="email" className="block text-xs text-gray-600 uppercase">
          Correo ElectrÃ³nico
        </label>
        <input
          id="email"
          name="email"
          type="email"
          placeholder="usuario@ejemplo.com"
          required
          className="mt-1 block w-full rounded-md border px-3 py-2 shadow-sm focus:border-black focus:outline-none focus:ring-black sm:text-sm"
        />
      </div>
      <div>
        <label htmlFor="password" className="block text-xs text-gray-600 uppercase">
          ContraseÃ±a
        </label>
        <input
          id="password"
          name="password"
          type="password"
          required
          className="mt-1 block w-full rounded-md border px-3 py-2 shadow-sm focus:border-black focus:outline-none focus:ring-black sm:text-sm"
        />
      </div>
      {children}
    </form>
  );
}

```

### `SubmitButton.tsx`

```tsx
'use client';

import { useFormStatus } from 'react-dom';

export function SubmitButton({ children }: { children: React.ReactNode }) {
  const { pending } = useFormStatus();

  return (
    <button
      type={pending ? 'button' : 'submit'}
      aria-disabled={pending}
      className="flex h-10 w-full items-center justify-center rounded-md border text-sm transition-all focus:outline-none"
    >
      {children}
      {pending && <span className="ml-2 animate-spin">â³</span>}
    </button>
  );
}

```

---

## ğŸ“Œ PÃ¡ginas de Login y Registro

![](https://res.cloudinary.com/dq0pfesxe/image/upload/v1742062537/Captura_de_pantalla_2025-03-15_191514_xhh83w.png)

### `login/page.tsx`

```tsx
import Link from 'next/link';
import { Form } from '../components/Form';
import { signIn } from '../lib/auth';
import { SubmitButton } from '../components/SubmitButton';

export default function Login() {
  return (
    <div className="flex h-screen items-center justify-center bg-gray-100">
      <div className="w-full max-w-md">
        <h2 className="text-2xl font-bold text-center">Iniciar SesiÃ³n</h2>
        <Form
          action={async (formData: FormData) => {
            await signIn(formData.get('email') as string, formData.get('password') as string);
          }}
        >
          <SubmitButton>Ingresar</SubmitButton>
        </Form>
        <p className="text-center text-sm">
          Â¿No tienes cuenta? <Link href="/register" className="text-blue-500">RegÃ­strate</Link>
        </p>
      </div>
    </div>
  );
}

```

### `register/page.tsx`

```tsx
import Link from 'next/link';
import { Form } from '../components/Form';
import { registerUser } from '../lib/auth';
import { SubmitButton } from '../components/SubmitButton';

export default function Register() {
  return (
    <div className="flex h-screen items-center justify-center bg-gray-100">
      <div className="w-full max-w-md">
        <h2 className="text-2xl font-bold text-center">Registro</h2>
        <Form
          action={async (formData: FormData) => {
            await registerUser(formData.get('email') as string, formData.get('password') as string);
          }}
        >
          <SubmitButton>Registrarse</SubmitButton>
        </Form>
        <p className="text-center text-sm">
          Â¿Ya tienes cuenta? <Link href="/login" className="text-blue-500">Inicia sesiÃ³n</Link>
        </p>
      </div>
    </div>
  );
}

```

---

## ğŸ“Œ PÃ¡ginas Protegida

Este pagina protegida o dashboard sirve como la pÃ¡gina principal donde los usuarios autenticados pueden acceder a su informaciÃ³n personal y otras funcionalidades relacionadas con su cuenta. EstÃ¡ diseÃ±ada para mostrar datos relevantes del usuario, como su nombre, correo electrÃ³nico, preferencias y cualquier otra informaciÃ³n importante que el sistema haya almacenado.

### `protected/page.tsx`

```tsx
import { auth, signOut } from "app/auth"

export default async function ProtectedPage() {
  const session = await auth()

  // Default avatar if no image is available
  const userInitial = session?.user?.email?.charAt(0).toUpperCase() || "U"

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-900 to-gray-800 text-white">
      <header className="border-b border-gray-800 py-4">
        <div className="container mx-auto px-6 flex justify-between items-center">
          <h1 className="text-2xl font-bold">AppName</h1>
          <SignOut />
        </div>
      </header>

      <main className="container mx-auto px-6 py-12">
        <div className="max-w-4xl mx-auto">
          {/* User Welcome Card */}
          <div className="bg-gray-800 rounded-2xl p-8 shadow-xl border border-gray-700">
            <div className="flex items-center space-x-6">
              {/* User Avatar */}
              <div className="w-20 h-20 rounded-full bg-blue-600 flex items-center justify-center text-2xl font-bold">
                {session?.user?.image ? (
                  <img
                    src={session.user.image || "/placeholder.svg"}
                    alt={session.user.name || "User"}
                    className="w-full h-full rounded-full object-cover"
                  />
                ) : (
                  userInitial
                )}
              </div>

              {/* User Info */}
              <div>
                <h2 className="text-2xl font-bold mb-1">{session?.user?.name || "Welcome back!"}</h2>
                <p className="text-gray-400">
                  You are logged in as <span className="text-blue-400 font-medium">{session?.user?.email}</span>
                </p>
              </div>
            </div>
          </div>

          {/* Dashboard Content */}
          <div className="mt-10 grid grid-cols-1 md:grid-cols-2 gap-6">
            <div className="bg-gray-800 rounded-xl p-6 border border-gray-700">
              <h3 className="text-xl font-semibold mb-4">Account Overview</h3>
              <div className="space-y-3">
                <div className="flex justify-between py-2 border-b border-gray-700">
                  <span className="text-gray-400">Email</span>
                  <span>{session?.user?.email}</span>
                </div>
                <div className="flex justify-between py-2 border-b border-gray-700">
                  <span className="text-gray-400">Account Type</span>
                  <span className="bg-blue-600 text-white text-xs px-2 py-1 rounded-full">Premium</span>
                </div>
                <div className="flex justify-between py-2 border-b border-gray-700">
                  <span className="text-gray-400">Member Since</span>
                  <span>{new Date().toLocaleDateString()}</span>
                </div>
              </div>
            </div>

            <div className="bg-gray-800 rounded-xl p-6 border border-gray-700">
              <h3 className="text-xl font-semibold mb-4">Quick Actions</h3>
              <div className="grid grid-cols-2 gap-4">
                <button className="p-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition duration-200 text-center">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    className="h-6 w-6 mx-auto mb-2"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                  </svg>
                  New Project
                </button>
                <button className="p-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition duration-200 text-center">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    className="h-6 w-6 mx-auto mb-2"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      strokeWidth={2}
                      d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                    />
                  </svg>
                  Calendar
                </button>
                <button className="p-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition duration-200 text-center">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    className="h-6 w-6 mx-auto mb-2"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      strokeWidth={2}
                      d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                    />
                  </svg>
                  Messages
                </button>
                <button className="p-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition duration-200 text-center">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    className="h-6 w-6 mx-auto mb-2"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      strokeWidth={2}
                      d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                    />
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      strokeWidth={2}
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                    />
                  </svg>
                  Settings
                </button>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  )
}

function SignOut() {
  return (
    <form
      action={async () => {
        "use server"
        await signOut()
      }}
    >
      <button
        type="submit"
        className="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white font-medium transition duration-200 flex items-center"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          className="h-5 w-5 mr-2"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth={2}
            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
          />
        </svg>
        Sign out
      </button>
    </form>
  )
}

```

![](https://res.cloudinary.com/dq0pfesxe/image/upload/v1742053319/Captura_de_pantalla_2025-03-15_163932_svo4ih.png)

si quieres saber como crear un login usando next-auth y github puedes mirar el siguiente articulo :

https://www.codeporx.com/blog/next/como-hacer-login-nextjs-nextauth

### **Preguntas Frecuentes (FAQ)**

### 1. **Â¿QuÃ© es NextAuth y por quÃ© lo usamos en este proyecto?**

**NextAuth** es una biblioteca de autenticaciÃ³n para aplicaciones de **Next.js**. Nos ayuda a manejar de manera sencilla y segura la autenticaciÃ³n de usuarios, como el inicio de sesiÃ³n con contraseÃ±as, proveedores externos (Google, GitHub, etc.), y mucho mÃ¡s. En este proyecto, usamos NextAuth para simplificar la gestiÃ³n de sesiones y autenticar usuarios en nuestra aplicaciÃ³n.

### 2. **Â¿Por quÃ© elegimos Supabase como base de datos?**

**Supabase** es una plataforma backend de cÃ³digo abierto que proporciona una alternativa a Firebase. Ofrece bases de datos PostgreSQL, autenticaciÃ³n, almacenamiento y otras funcionalidades listas para usar. Elegimos Supabase porque su integraciÃ³n con **Next.js** y **NextAuth** es muy fÃ¡cil, y nos permite gestionar la autenticaciÃ³n, almacenar datos de usuarios y manejar la seguridad de manera efectiva.

### 3. **Â¿QuÃ© es Drizzle y cÃ³mo lo utilizamos en este proyecto?**

**Drizzle** es una biblioteca que facilita la interacciÃ³n con **Smart Contracts** en aplicaciones **Web3**. Aunque en este artÃ­culo nos centramos en el sistema de autenticaciÃ³n, en algunos casos podrÃ­amos integrar Drizzle para interactuar con contratos inteligentes en el futuro. Drizzle puede ser Ãºtil si planeas agregar caracterÃ­sticas de blockchain a tu aplicaciÃ³n en el futuro.

### 4. **Â¿CÃ³mo funciona el flujo de autenticaciÃ³n en este proyecto?**

En este proyecto, usamos **NextAuth** para gestionar el flujo de autenticaciÃ³n. Cuando un usuario intenta iniciar sesiÃ³n, NextAuth maneja el proceso de validaciÃ³n utilizando la base de datos de **Supabase**. Si las credenciales son correctas, el usuario es autenticado y redirigido a una pÃ¡gina protegida donde puede acceder a su informaciÃ³n personal. Si las credenciales son incorrectas, el sistema muestra un mensaje de error.

### 5. **Â¿Es seguro usar NextAuth con Supabase para gestionar la autenticaciÃ³n?**

SÃ­, **NextAuth** y **Supabase** estÃ¡n diseÃ±ados para ser seguros. **NextAuth** maneja el proceso de autenticaciÃ³n de manera robusta, utilizando tÃ©cnicas modernas como tokens JWT para las sesiones. AdemÃ¡s, **Supabase** utiliza **PostgreSQL** con cifrado y protecciÃ³n adecuada, lo que garantiza que los datos de los usuarios estÃ©n protegidos.

### 6. **Â¿CÃ³mo puedo personalizar las pantallas de inicio de sesiÃ³n y registro?**

Puedes personalizar las pantallas de inicio de sesiÃ³n y registro modificando los componentes de React en tu proyecto. Por ejemplo, puedes cambiar los estilos, agregar campos personalizados o modificar el comportamiento del formulario. El uso de **Next.js** y sus rutas hace que estas modificaciones sean simples, ya que puedes agregar fÃ¡cilmente nuevas pÃ¡ginas o componentes personalizados.

### 7. **Â¿QuÃ© sucede si un usuario olvida su contraseÃ±a?**

Puedes integrar un flujo de recuperaciÃ³n de contraseÃ±a en tu aplicaciÃ³n utilizando las funciones de autenticaciÃ³n de **Supabase**. Supabase proporciona un mÃ©todo de **reset de contraseÃ±a** que puedes utilizar para enviar un enlace de recuperaciÃ³n a la direcciÃ³n de correo electrÃ³nico del usuario.

### 8. **Â¿Puedo utilizar proveedores de autenticaciÃ³n como Google o GitHub?**

SÃ­, **NextAuth** permite integrar proveedores de autenticaciÃ³n externos, como **Google**, **GitHub**, **Twitter**, etc. Solo necesitas configurar estos proveedores en el archivo de configuraciÃ³n de NextAuth. Esto permite que los usuarios se autentiquen a travÃ©s de sus cuentas de redes sociales, simplificando el proceso de inicio de sesiÃ³n.

### 9. **Â¿CÃ³mo puedo proteger rutas o pÃ¡ginas especÃ­ficas solo para usuarios autenticados?**

Para proteger una pÃ¡gina en **Next.js**, puedes usar un sistema de middleware o simplemente verificar la sesiÃ³n del usuario en cada pÃ¡gina. En el ejemplo proporcionado en este artÃ­culo, la pÃ¡gina **protected/page.tsx** solo se muestra a usuarios autenticados, y si el usuario no estÃ¡ autenticado, se le redirige a la pÃ¡gina de inicio de sesiÃ³n.

### 10. **Â¿QuÃ© pasa si un usuario cierra sesiÃ³n?**

Cuando un usuario cierra sesiÃ³n, la sesiÃ³n se invalida y el acceso a las rutas protegidas se restringe hasta que inicie sesiÃ³n nuevamente. El proceso de cierre de sesiÃ³n se maneja fÃ¡cilmente con el mÃ©todo **signOut()** de **NextAuth**, que elimina los datos de la sesiÃ³n y redirige al usuario a la pÃ¡gina de inicio.

### 11. **Â¿CÃ³mo puedo manejar errores en el proceso de inicio de sesiÃ³n?**

Puedes manejar errores de inicio de sesiÃ³n aÃ±adiendo un sistema de manejo de errores en el formulario de login. **NextAuth** proporciona mecanismos para capturar errores durante el proceso de autenticaciÃ³n, como errores de credenciales incorrectas, y puedes mostrar estos errores al usuario en la interfaz de usuario.

### 12. **Â¿Puedo usar otro proveedor de base de datos en lugar de Supabase?**

SÃ­, aunque en este artÃ­culo usamos **Supabase** por su integraciÃ³n fÃ¡cil y rÃ¡pida con **NextAuth**, puedes usar otros proveedores de bases de datos como **MongoDB**, **MySQL**, **Prisma**, o cualquier otro que soporte **NextAuth**. Solo necesitarÃ­as ajustar la configuraciÃ³n en el archivo de NextAuth para conectar tu aplicaciÃ³n con el proveedor que elijas.

### 13. **Â¿Se pueden realizar validaciones personalizadas en los formularios de login y registro?**

SÃ­, puedes agregar validaciones personalizadas utilizando bibliotecas como **Yup** o **Formik** en el frontend. Por ejemplo, puedes validar que los correos electrÃ³nicos sean vÃ¡lidos, que las contraseÃ±as tengan una longitud mÃ­nima o que los campos no estÃ©n vacÃ­os antes de enviar el formulario al backend.

### 14. **Â¿QuÃ© es un token JWT y cÃ³mo se usa en NextAuth?**

Un **token JWT** (JSON Web Token) es un formato seguro de transmisiÃ³n de informaciÃ³n entre el cliente y el servidor. En el contexto de **NextAuth**, se utiliza para gestionar las sesiones del usuario. Cuando un usuario inicia sesiÃ³n, NextAuth emite un token JWT que se guarda en el navegador del usuario y se utiliza para autenticar las solicitudes subsecuentes hasta que la sesiÃ³n expire.

### 15. **Â¿QuÃ© es un "callback URL" en NextAuth y cÃ³mo lo configuro?**

El **callback URL** es la direcciÃ³n a la que los usuarios serÃ¡n redirigidos despuÃ©s de completar el proceso de autenticaciÃ³n. En el caso de **NextAuth**, puedes configurar la URL de redirecciÃ³n en el archivo de configuraciÃ³n para asegurarte de que el usuario vuelva a la pÃ¡gina correcta despuÃ©s de iniciar sesiÃ³n o registrarse.