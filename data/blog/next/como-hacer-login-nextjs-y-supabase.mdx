---
title: '‚û°Ô∏èComo Implementar Autenticaci√≥n con Next.js y Supabase en Vercel: paso a paso'
date: '2025-03-15'
tags: ['nextjs', 'autenticacion', 'supabase']
draft: false
summary: 'Aprende a implementar un sistema de autenticaci√≥n seguro en Next.js utilizando NextAuth.js. Sigue esta gu√≠a paso a paso para integrar login con proveedores como Google, GitHub y m√°s.'
authors: ['default']
---
En este art√≠culo, te ense√±ar√© c√≥mo implementar autenticaci√≥n en **Next.js** utilizando **Supabase**. Usaremos **Supabase desde Vercel** y nos conectaremos a nuestra base de datos con **Drizzle ORM** y **NextAuth.js**.

![](https://res.cloudinary.com/dq0pfesxe/image/upload/v1742053319/Captura_de_pantalla_2025-03-15_163932_svo4ih.png)

## Requisitos

Antes de comenzar, aseg√∫rate de tener lo siguiente:

- ‚úÖ Una cuenta en **Supabase**
- ‚úÖ Una cuenta en **Vercel**
- ‚úÖ Un proyecto **Next.js** ya configurado

---

## Paso 1: Crear la base de datos en Vercel

Lo primero que haremos ser√° crear nuestra base de datos **PostgreSQL** desde **Vercel**. En este caso, utilizaremos el plan gratuito de **Supabase**.

üîó **Ingresa a Vercel:** https://vercel.com/

### 1Ô∏è‚É£ Seleccionar el proveedor de la base de datos

![](https://res.cloudinary.com/dq0pfesxe/image/upload/v1742053318/Captura_de_pantalla_2025-03-15_161017_puspge.png)

En Supabase, dentro de la secci√≥n **Storage**, podemos crear bases de datos de diferentes proveedores. Selecciona **"Create Database"** y elige **Supabase**.

![](https://res.cloudinary.com/dq0pfesxe/image/upload/v1742053318/Captura_de_pantalla_2025-03-15_161027_bojsop.png)

### 2Ô∏è‚É£ Elegir el plan gratuito

En este caso, usaremos el **plan gratuito**, que funciona bastante bien para desarrollo.

### 3Ô∏è‚É£ Obtener las variables de entorno

Una vez creada la base de datos, se nos proporcionar√°n las variables de entorno necesarias para la conexi√≥n.

![](https://res.cloudinary.com/dq0pfesxe/image/upload/v1742053319/Captura_de_pantalla_2025-03-15_161211_dg8mez.png)

Agrega estas variables a tu archivo **.env** en tu proyecto:

```
POSTGRES_URL=
POSTGRES_PRISMA_URL=
POSTGRES_URL_NON_POOLING=

```

Adem√°s, para trabajar en **localhost**, necesitaremos una variable extra:

```
AUTH_SECRET=

```

üîó Puedes generar una clave segura en este enlace: [Generate Secret](https://generate-secret.vercel.app/32)

---

## Paso 2: Instalar dependencias

Ahora instalemos todas las dependencias necesarias para que el proyecto funcione correctamente.

```bash
npm i bcrypt-ts
npm i drizzle-orm pg dotenv
npm i -D drizzle-kit tsx @types/pg
npm i next-auth

```

---

## Paso 3: Estructura de archivos

Antes de comenzar con la configuraci√≥n, definamos la estructura del proyecto.

```
üì¶ app
 ‚î£ üìÇ api
 ‚îÉ ‚îó üìÇ auth
 ‚îÉ ‚îÉ ‚îó üìÇ [...nextauth]
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìÑ route.ts
 ‚î£ üìÇ login
 ‚îÉ ‚îó üìÑ page.tsx
 ‚î£ üìÇ register
 ‚îÉ ‚îó üìÑ page.tsx
 ‚î£ üìÇ protected
 ‚îÉ ‚îó üìÑ page.tsx
 ‚î£ üìÑ auth.config.ts
 ‚î£ üìÑ auth.ts
 ‚î£ üìÑ db.ts
 ‚î£ üìÑ page.tsx
 ‚î£ üìÑ Form.tsx
 ‚î£ üìÑ SubmitButton.tsx
 üìÑ middleware.ts
 üìÑ .env

```

Con esto, ya tenemos nuestra base lista para implementar la autenticaci√≥n con **NextAuth.js**. üöÄ

# Paso 4: Crear la l√≥gica de autenticaci√≥n

En este paso, construiremos toda la l√≥gica de autenticaci√≥n utilizando **Drizzle ORM**, **NextAuth.js** y **bcrypt-ts** para el manejo de usuarios y contrase√±as encriptadas.

---

## üìå **Definir la base de datos con Drizzle ORM**

La base de datos y el esquema de usuario estar√°n en el archivo `db.ts`.

### üìÑ `db.ts`

Este archivo define la conexi√≥n a la base de datos PostgreSQL, maneja la creaci√≥n de la tabla `User`, y proporciona funciones para registrar y buscar usuarios.

```tsx
import { drizzle } from 'drizzle-orm/postgres-js';
import { pgTable, serial, varchar } from 'drizzle-orm/pg-core';
import { eq } from 'drizzle-orm';
import postgres from 'postgres';
import { genSaltSync, hashSync } from 'bcrypt-ts';

// Conectamos a la base de datos con PostgreSQL y habilitamos SSL
let client = postgres(`${process.env.POSTGRES_URL!}?sslmode=require`);
let db = drizzle(client);

// Funci√≥n para obtener un usuario por su email
export async function getUser(email: string) {
  const users = await ensureTableExists();
  return await db.select().from(users).where(eq(users.email, email));
}

// Funci√≥n para crear un usuario con contrase√±a encriptada
export async function createUser(email: string, password: string) {
  const users = await ensureTableExists();
  let salt = genSaltSync(10); // Generamos un "sal" para la encriptaci√≥n
  let hash = hashSync(password, salt); // Hasheamos la contrase√±a

  return await db.insert(users).values({ email, password: hash });
}

// Funci√≥n para verificar si la tabla "User" existe, si no, la crea
async function ensureTableExists() {
  const result = await client`
    SELECT EXISTS (
      SELECT FROM information_schema.tables
      WHERE table_schema = 'public'
      AND table_name = 'User'
    );`;

  if (!result[0].exists) {
    await client`
      CREATE TABLE "User" (
        id SERIAL PRIMARY KEY,
        email VARCHAR(64),
        password VARCHAR(64)
      );`;
  }

  // Definimos la estructura de la tabla "User"
  const table = pgTable('User', {
    id: serial('id').primaryKey(),
    email: varchar('email', { length: 64 }),
    password: varchar('password', { length: 64 }),
  });

  return table;
}

```

‚úÖ **Explicaci√≥n:**

- Se conecta a la base de datos usando `postgres()` y `drizzle()`.
- `getUser(email)` busca un usuario por su correo electr√≥nico.
- `createUser(email, password)` guarda un usuario con la contrase√±a encriptada con `bcrypt-ts`.
- `ensureTableExists()` verifica si la tabla `User` existe; si no, la crea.

[supabase table](https://res.cloudinary.com/dq0pfesxe/image/upload/v1742063040/Captura_de_pantalla_2025-03-15_192312_dfs7cf.png)
---

## üìå **Configurar la autenticaci√≥n con NextAuth.js**

La l√≥gica de autenticaci√≥n se divide en dos archivos:

1. **`auth.ts`**: Define los controladores de inicio de sesi√≥n con credenciales.
2. **`auth.config.ts`**: Configura los callbacks y redirecciones de NextAuth.

### üìÑ `auth.ts`

Este archivo define c√≥mo se maneja la autenticaci√≥n con **NextAuth.js** y **credenciales personalizadas (email y contrase√±a)**.

```tsx
import NextAuth from 'next-auth';
import Credentials from 'next-auth/providers/credentials';
import { compare } from 'bcrypt-ts';
import { getUser } from 'app/db';
import { authConfig } from 'app/auth.config';

export const {
  handlers: { GET, POST }, // M√©todos para manejar autenticaci√≥n desde API
  auth, // Middleware de autenticaci√≥n
  signIn, // Funci√≥n para iniciar sesi√≥n
  signOut, // Funci√≥n para cerrar sesi√≥n
} = NextAuth({
  ...authConfig,
  providers: [
    Credentials({
      async authorize({ email, password }: any) {
        let user = await getUser(email);
        if (user.length === 0) return null;

        let passwordsMatch = await compare(password, user[0].password!);
        if (passwordsMatch) return user[0] as any; // Retorna el usuario si la contrase√±a es v√°lida
        return null; // Si la contrase√±a no coincide, retorna null
      },
    }),
  ],
});

```

‚úÖ **Explicaci√≥n:**

- Se importa `NextAuth` y `Credentials` para manejar autenticaci√≥n con credenciales.
- `getUser(email)` recupera el usuario desde la base de datos.
- Se usa `bcrypt-ts` para comparar la contrase√±a ingresada con la almacenada.
- `signIn` y `signOut` manejan el inicio y cierre de sesi√≥n.

---

### üìÑ `auth.config.ts`

Define la configuraci√≥n general de NextAuth, incluyendo p√°ginas personalizadas y reglas de acceso.

```tsx
import { NextAuthConfig } from 'next-auth';

export const authConfig = {
  pages: {
    signIn: '/login', // Redirige a /login cuando se requiere autenticaci√≥n
  },
  callbacks: {
    authorized({ auth, request: { nextUrl } }) {
      let isLoggedIn = !!auth?.user; // Verifica si el usuario est√° autenticado
      let isOnDashboard = nextUrl.pathname.startsWith('/protected'); // Verifica si est√° en una ruta protegida

      if (isOnDashboard) {
        if (isLoggedIn) return true;
        return false; // Si no est√° autenticado, se le bloquea el acceso
      } else if (isLoggedIn) {
        return Response.redirect(new URL('/protected', nextUrl)); // Redirige a /protected si ya est√° logueado
      }

      return true;
    },
  },
} satisfies NextAuthConfig;

```

‚úÖ **Explicaci√≥n:**

- **`signIn: '/login'`** ‚Üí Personaliza la p√°gina de inicio de sesi√≥n.
- **`callbacks.authorized`** ‚Üí Define reglas de acceso a rutas protegidas.
    - Si el usuario intenta acceder a `/protected` sin autenticarse, se bloquea.
    - Si ya est√° autenticado y est√° en la p√°gina de inicio, lo redirige a `/protected`.

---

## üìå **Configurar NextAuth en las rutas API**

En **Next.js App Router**, debemos exportar los controladores `GET` y `POST` de autenticaci√≥n.

### üìÑ `api/auth/[...nextauth]/route.ts`

```tsx
export { GET, POST } from 'app/auth';

```

‚úÖ **Explicaci√≥n:**

- Esto simplemente reexporta los m√©todos `GET` y `POST` definidos en `auth.ts`.
- Esto permite que NextAuth maneje la autenticaci√≥n a trav√©s de `/api/auth`.

---

## üìå **Configurar middleware para proteger rutas**

Finalmente, creamos un **middleware** que bloquear√° el acceso a rutas protegidas si el usuario no est√° autenticado.

### üìÑ `middleware.ts`

```tsx
import NextAuth from 'next-auth';
import { authConfig } from 'app/auth.config';

export default NextAuth(authConfig).auth;

export const config = {
  matcher: ['/((?!api|_next/static|_next/image|.*\\.png$).*)'], // Aplica el middleware a todas las rutas excepto las est√°ticas y la API
};

```

‚úÖ **Explicaci√≥n:**

- **`NextAuth(authConfig).auth;`** ‚Üí Usa la configuraci√≥n de `auth.config.ts`.
- **`matcher`** ‚Üí Aplica el middleware a todas las rutas **excepto**:
    - `api/` (rutas de API)
    - `_next/static` y `_next/image` (archivos est√°ticos)
    - Im√°genes (`.png`)

---

## üéØ **Resumen**

1. **`db.ts`** ‚Üí Conexi√≥n a PostgreSQL y definici√≥n de la tabla `User`.
2. **`auth.ts`** ‚Üí L√≥gica de autenticaci√≥n con credenciales y NextAuth.
3. **`auth.config.ts`** ‚Üí Configuraci√≥n de p√°ginas y reglas de acceso.
4. **`api/auth/[...nextauth]/route.ts`** ‚Üí Reexporta `GET` y `POST` para la API de autenticaci√≥n.
5. **`middleware.ts`** ‚Üí Protege rutas privadas.

## Paso 5: Crear P√°ginas y Utilizar la L√≥gica de Autenticaci√≥n

En este paso, comenzaremos a consumir la l√≥gica creada previamente para manejar la autenticaci√≥n, redirigir a una p√°gina protegida y visualizar las tablas de nuestra base de datos.

---

## üìå P√°gina de Bienvenida (`page.tsx`)

La p√°gina de bienvenida es el primer punto de contacto de los usuarios con nuestra aplicaci√≥n. Desde aqu√≠ pueden iniciar sesi√≥n o registrarse.

![](https://res.cloudinary.com/dq0pfesxe/image/upload/v1742062538/Captura_de_pantalla_2025-03-15_191523_z0cqcn.png)

```tsx
import Link from "next/link";

export default function Page() {
  return (
    <div className="min-h-screen flex flex-col bg-gradient-to-br from-gray-900 to-gray-800">
      <main className="flex-1 flex flex-col items-center justify-center p-6">
        <div className="w-full max-w-md">
          <div className="text-center mb-10">
            <h1 className="text-4xl font-bold text-white mb-2">AppName</h1>
            <p className="text-gray-400">Tu soluci√≥n simple para todo</p>
          </div>

          <div className="bg-white rounded-2xl shadow-2xl overflow-hidden">
            <div className="p-8 text-center border-b border-gray-200">
              <h2 className="text-2xl font-bold text-gray-800">Bienvenido</h2>
              <p className="text-gray-600 mt-1">Por favor, inicia sesi√≥n o crea una cuenta</p>
            </div>

            <div className="p-6 space-y-4">
              <Link
                href="/login"
                className="block w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white font-medium text-center rounded-lg transition duration-200"
              >
                Iniciar Sesi√≥n
              </Link>

              <Link
                href="/register"
                className="block w-full py-3 px-4 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium text-center rounded-lg transition duration-200"
              >
                Registrarse
              </Link>
            </div>
          </div>
        </div>
      </main>

      <footer className="py-6 text-center text-gray-500 text-sm">
        <p>&copy; {new Date().getFullYear()} AppName. Todos los derechos reservados.</p>
      </footer>
    </div>
  );
}

```

### Explicaci√≥n:

- Presenta dos botones principales: **Iniciar Sesi√≥n** y **Registrarse**.
- No requiere autenticaci√≥n para acceder.

---

## üìå Componentes Comunes: `Form.tsx` y `SubmitButton.tsx`

Estos componentes nos ayudar√°n a evitar redundancia en las p√°ginas de login y registro.

### `Form.tsx`

```tsx
export function Form({
  action,
  children,
}: {
  action: any;
  children: React.ReactNode;
}) {
  return (
    <form action={action} className="flex flex-col space-y-4 bg-gray-50 px-4 py-8 sm:px-16">
      <div>
        <label htmlFor="email" className="block text-xs text-gray-600 uppercase">
          Correo Electr√≥nico
        </label>
        <input
          id="email"
          name="email"
          type="email"
          placeholder="usuario@ejemplo.com"
          required
          className="mt-1 block w-full rounded-md border px-3 py-2 shadow-sm focus:border-black focus:outline-none focus:ring-black sm:text-sm"
        />
      </div>
      <div>
        <label htmlFor="password" className="block text-xs text-gray-600 uppercase">
          Contrase√±a
        </label>
        <input
          id="password"
          name="password"
          type="password"
          required
          className="mt-1 block w-full rounded-md border px-3 py-2 shadow-sm focus:border-black focus:outline-none focus:ring-black sm:text-sm"
        />
      </div>
      {children}
    </form>
  );
}

```

### `SubmitButton.tsx`

```tsx
'use client';

import { useFormStatus } from 'react-dom';

export function SubmitButton({ children }: { children: React.ReactNode }) {
  const { pending } = useFormStatus();

  return (
    <button
      type={pending ? 'button' : 'submit'}
      aria-disabled={pending}
      className="flex h-10 w-full items-center justify-center rounded-md border text-sm transition-all focus:outline-none"
    >
      {children}
      {pending && <span className="ml-2 animate-spin">‚è≥</span>}
    </button>
  );
}

```

---

## üìå P√°ginas de Login y Registro

![](https://res.cloudinary.com/dq0pfesxe/image/upload/v1742062537/Captura_de_pantalla_2025-03-15_191514_xhh83w.png)

### `login/page.tsx`

```tsx
import Link from 'next/link';
import { Form } from '../components/Form';
import { signIn } from '../lib/auth';
import { SubmitButton } from '../components/SubmitButton';

export default function Login() {
  return (
    <div className="flex h-screen items-center justify-center bg-gray-100">
      <div className="w-full max-w-md">
        <h2 className="text-2xl font-bold text-center">Iniciar Sesi√≥n</h2>
        <Form
          action={async (formData: FormData) => {
            await signIn(formData.get('email') as string, formData.get('password') as string);
          }}
        >
          <SubmitButton>Ingresar</SubmitButton>
        </Form>
        <p className="text-center text-sm">
          ¬øNo tienes cuenta? <Link href="/register" className="text-blue-500">Reg√≠strate</Link>
        </p>
      </div>
    </div>
  );
}

```

### `register/page.tsx`

```tsx
import Link from 'next/link';
import { Form } from '../components/Form';
import { registerUser } from '../lib/auth';
import { SubmitButton } from '../components/SubmitButton';

export default function Register() {
  return (
    <div className="flex h-screen items-center justify-center bg-gray-100">
      <div className="w-full max-w-md">
        <h2 className="text-2xl font-bold text-center">Registro</h2>
        <Form
          action={async (formData: FormData) => {
            await registerUser(formData.get('email') as string, formData.get('password') as string);
          }}
        >
          <SubmitButton>Registrarse</SubmitButton>
        </Form>
        <p className="text-center text-sm">
          ¬øYa tienes cuenta? <Link href="/login" className="text-blue-500">Inicia sesi√≥n</Link>
        </p>
      </div>
    </div>
  );
}

```

---

## üìå P√°ginas Protegida

Este pagina protegida o dashboard sirve como la p√°gina principal donde los usuarios autenticados pueden acceder a su informaci√≥n personal y otras funcionalidades relacionadas con su cuenta. Est√° dise√±ada para mostrar datos relevantes del usuario, como su nombre, correo electr√≥nico, preferencias y cualquier otra informaci√≥n importante que el sistema haya almacenado.

### `protected/page.tsx`

```tsx
import { auth, signOut } from "app/auth"

export default async function ProtectedPage() {
  const session = await auth()

  // Default avatar if no image is available
  const userInitial = session?.user?.email?.charAt(0).toUpperCase() || "U"

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-900 to-gray-800 text-white">
      <header className="border-b border-gray-800 py-4">
        <div className="container mx-auto px-6 flex justify-between items-center">
          <h1 className="text-2xl font-bold">AppName</h1>
          <SignOut />
        </div>
      </header>

      <main className="container mx-auto px-6 py-12">
        <div className="max-w-4xl mx-auto">
          {/* User Welcome Card */}
          <div className="bg-gray-800 rounded-2xl p-8 shadow-xl border border-gray-700">
            <div className="flex items-center space-x-6">
              {/* User Avatar */}
              <div className="w-20 h-20 rounded-full bg-blue-600 flex items-center justify-center text-2xl font-bold">
                {session?.user?.image ? (
                  <img
                    src={session.user.image || "/placeholder.svg"}
                    alt={session.user.name || "User"}
                    className="w-full h-full rounded-full object-cover"
                  />
                ) : (
                  userInitial
                )}
              </div>

              {/* User Info */}
              <div>
                <h2 className="text-2xl font-bold mb-1">{session?.user?.name || "Welcome back!"}</h2>
                <p className="text-gray-400">
                  You are logged in as <span className="text-blue-400 font-medium">{session?.user?.email}</span>
                </p>
              </div>
            </div>
          </div>

          {/* Dashboard Content */}
          <div className="mt-10 grid grid-cols-1 md:grid-cols-2 gap-6">
            <div className="bg-gray-800 rounded-xl p-6 border border-gray-700">
              <h3 className="text-xl font-semibold mb-4">Account Overview</h3>
              <div className="space-y-3">
                <div className="flex justify-between py-2 border-b border-gray-700">
                  <span className="text-gray-400">Email</span>
                  <span>{session?.user?.email}</span>
                </div>
                <div className="flex justify-between py-2 border-b border-gray-700">
                  <span className="text-gray-400">Account Type</span>
                  <span className="bg-blue-600 text-white text-xs px-2 py-1 rounded-full">Premium</span>
                </div>
                <div className="flex justify-between py-2 border-b border-gray-700">
                  <span className="text-gray-400">Member Since</span>
                  <span>{new Date().toLocaleDateString()}</span>
                </div>
              </div>
            </div>

            <div className="bg-gray-800 rounded-xl p-6 border border-gray-700">
              <h3 className="text-xl font-semibold mb-4">Quick Actions</h3>
              <div className="grid grid-cols-2 gap-4">
                <button className="p-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition duration-200 text-center">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    className="h-6 w-6 mx-auto mb-2"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                  </svg>
                  New Project
                </button>
                <button className="p-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition duration-200 text-center">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    className="h-6 w-6 mx-auto mb-2"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      strokeWidth={2}
                      d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                    />
                  </svg>
                  Calendar
                </button>
                <button className="p-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition duration-200 text-center">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    className="h-6 w-6 mx-auto mb-2"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      strokeWidth={2}
                      d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                    />
                  </svg>
                  Messages
                </button>
                <button className="p-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition duration-200 text-center">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    className="h-6 w-6 mx-auto mb-2"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      strokeWidth={2}
                      d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                    />
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      strokeWidth={2}
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                    />
                  </svg>
                  Settings
                </button>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  )
}

function SignOut() {
  return (
    <form
      action={async () => {
        "use server"
        await signOut()
      }}
    >
      <button
        type="submit"
        className="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white font-medium transition duration-200 flex items-center"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          className="h-5 w-5 mr-2"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth={2}
            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
          />
        </svg>
        Sign out
      </button>
    </form>
  )
}

```

![](https://res.cloudinary.com/dq0pfesxe/image/upload/v1742053319/Captura_de_pantalla_2025-03-15_163932_svo4ih.png)

si quieres saber como crear un login usando next-auth y github puedes mirar el siguiente articulo :

https://www.codeporx.com/blog/next/como-hacer-login-nextjs-nextauth

### **Preguntas Frecuentes (FAQ)**

### 1. **¬øQu√© es NextAuth y por qu√© lo usamos en este proyecto?**

**NextAuth** es una biblioteca de autenticaci√≥n para aplicaciones de **Next.js**. Nos ayuda a manejar de manera sencilla y segura la autenticaci√≥n de usuarios, como el inicio de sesi√≥n con contrase√±as, proveedores externos (Google, GitHub, etc.), y mucho m√°s. En este proyecto, usamos NextAuth para simplificar la gesti√≥n de sesiones y autenticar usuarios en nuestra aplicaci√≥n.

### 2. **¬øPor qu√© elegimos Supabase como base de datos?**

**Supabase** es una plataforma backend de c√≥digo abierto que proporciona una alternativa a Firebase. Ofrece bases de datos PostgreSQL, autenticaci√≥n, almacenamiento y otras funcionalidades listas para usar. Elegimos Supabase porque su integraci√≥n con **Next.js** y **NextAuth** es muy f√°cil, y nos permite gestionar la autenticaci√≥n, almacenar datos de usuarios y manejar la seguridad de manera efectiva.

### 3. **¬øQu√© es Drizzle y c√≥mo lo utilizamos en este proyecto?**

**Drizzle** es una biblioteca que facilita la interacci√≥n con **Smart Contracts** en aplicaciones **Web3**. Aunque en este art√≠culo nos centramos en el sistema de autenticaci√≥n, en algunos casos podr√≠amos integrar Drizzle para interactuar con contratos inteligentes en el futuro. Drizzle puede ser √∫til si planeas agregar caracter√≠sticas de blockchain a tu aplicaci√≥n en el futuro.

### 4. **¬øC√≥mo funciona el flujo de autenticaci√≥n en este proyecto?**

En este proyecto, usamos **NextAuth** para gestionar el flujo de autenticaci√≥n. Cuando un usuario intenta iniciar sesi√≥n, NextAuth maneja el proceso de validaci√≥n utilizando la base de datos de **Supabase**. Si las credenciales son correctas, el usuario es autenticado y redirigido a una p√°gina protegida donde puede acceder a su informaci√≥n personal. Si las credenciales son incorrectas, el sistema muestra un mensaje de error.

### 5. **¬øEs seguro usar NextAuth con Supabase para gestionar la autenticaci√≥n?**

S√≠, **NextAuth** y **Supabase** est√°n dise√±ados para ser seguros. **NextAuth** maneja el proceso de autenticaci√≥n de manera robusta, utilizando t√©cnicas modernas como tokens JWT para las sesiones. Adem√°s, **Supabase** utiliza **PostgreSQL** con cifrado y protecci√≥n adecuada, lo que garantiza que los datos de los usuarios est√©n protegidos.

### 6. **¬øC√≥mo puedo personalizar las pantallas de inicio de sesi√≥n y registro?**

Puedes personalizar las pantallas de inicio de sesi√≥n y registro modificando los componentes de React en tu proyecto. Por ejemplo, puedes cambiar los estilos, agregar campos personalizados o modificar el comportamiento del formulario. El uso de **Next.js** y sus rutas hace que estas modificaciones sean simples, ya que puedes agregar f√°cilmente nuevas p√°ginas o componentes personalizados.

### 7. **¬øQu√© sucede si un usuario olvida su contrase√±a?**

Puedes integrar un flujo de recuperaci√≥n de contrase√±a en tu aplicaci√≥n utilizando las funciones de autenticaci√≥n de **Supabase**. Supabase proporciona un m√©todo de **reset de contrase√±a** que puedes utilizar para enviar un enlace de recuperaci√≥n a la direcci√≥n de correo electr√≥nico del usuario.

### 8. **¬øPuedo utilizar proveedores de autenticaci√≥n como Google o GitHub?**

S√≠, **NextAuth** permite integrar proveedores de autenticaci√≥n externos, como **Google**, **GitHub**, **Twitter**, etc. Solo necesitas configurar estos proveedores en el archivo de configuraci√≥n de NextAuth. Esto permite que los usuarios se autentiquen a trav√©s de sus cuentas de redes sociales, simplificando el proceso de inicio de sesi√≥n.

### 9. **¬øC√≥mo puedo proteger rutas o p√°ginas espec√≠ficas solo para usuarios autenticados?**

Para proteger una p√°gina en **Next.js**, puedes usar un sistema de middleware o simplemente verificar la sesi√≥n del usuario en cada p√°gina. En el ejemplo proporcionado en este art√≠culo, la p√°gina **protected/page.tsx** solo se muestra a usuarios autenticados, y si el usuario no est√° autenticado, se le redirige a la p√°gina de inicio de sesi√≥n.

### 10. **¬øQu√© pasa si un usuario cierra sesi√≥n?**

Cuando un usuario cierra sesi√≥n, la sesi√≥n se invalida y el acceso a las rutas protegidas se restringe hasta que inicie sesi√≥n nuevamente. El proceso de cierre de sesi√≥n se maneja f√°cilmente con el m√©todo **signOut()** de **NextAuth**, que elimina los datos de la sesi√≥n y redirige al usuario a la p√°gina de inicio.

### 11. **¬øC√≥mo puedo manejar errores en el proceso de inicio de sesi√≥n?**

Puedes manejar errores de inicio de sesi√≥n a√±adiendo un sistema de manejo de errores en el formulario de login. **NextAuth** proporciona mecanismos para capturar errores durante el proceso de autenticaci√≥n, como errores de credenciales incorrectas, y puedes mostrar estos errores al usuario en la interfaz de usuario.

### 12. **¬øPuedo usar otro proveedor de base de datos en lugar de Supabase?**

S√≠, aunque en este art√≠culo usamos **Supabase** por su integraci√≥n f√°cil y r√°pida con **NextAuth**, puedes usar otros proveedores de bases de datos como **MongoDB**, **MySQL**, **Prisma**, o cualquier otro que soporte **NextAuth**. Solo necesitar√≠as ajustar la configuraci√≥n en el archivo de NextAuth para conectar tu aplicaci√≥n con el proveedor que elijas.

### 13. **¬øSe pueden realizar validaciones personalizadas en los formularios de login y registro?**

S√≠, puedes agregar validaciones personalizadas utilizando bibliotecas como **Yup** o **Formik** en el frontend. Por ejemplo, puedes validar que los correos electr√≥nicos sean v√°lidos, que las contrase√±as tengan una longitud m√≠nima o que los campos no est√©n vac√≠os antes de enviar el formulario al backend.

### 14. **¬øQu√© es un token JWT y c√≥mo se usa en NextAuth?**

Un **token JWT** (JSON Web Token) es un formato seguro de transmisi√≥n de informaci√≥n entre el cliente y el servidor. En el contexto de **NextAuth**, se utiliza para gestionar las sesiones del usuario. Cuando un usuario inicia sesi√≥n, NextAuth emite un token JWT que se guarda en el navegador del usuario y se utiliza para autenticar las solicitudes subsecuentes hasta que la sesi√≥n expire.

### 15. **¬øQu√© es un "callback URL" en NextAuth y c√≥mo lo configuro?**

El **callback URL** es la direcci√≥n a la que los usuarios ser√°n redirigidos despu√©s de completar el proceso de autenticaci√≥n. En el caso de **NextAuth**, puedes configurar la URL de redirecci√≥n en el archivo de configuraci√≥n para asegurarte de que el usuario vuelva a la p√°gina correcta despu√©s de iniciar sesi√≥n o registrarse.